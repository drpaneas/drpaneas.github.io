<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>How to submit to QADB when MTUI fails &middot; Panos Georgiadis</title>

  
  <link rel="stylesheet" href="https://w3.suse.de/~pgeorgiadis/public/css/poole.css">
  
  
  
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  
  

  <meta name="description" content="Get yourserlf familiar with ctcs2 framework and results.">
  <meta name="keywords" content="panos georgiadis, panos, drpaneas, linux, programming, guitar, paok, opensuse, suse">
  
</head>
<body class="theme-base-08">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
        <img src="https://w3.suse.de/~pgeorgiadis/publicpanos.png" alt="panos" height="200" width="200" >
        <h1>Panos Georgiadis</h1>
      
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://w3.suse.de/~pgeorgiadis/public/">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="/~pgeorgiadis/public/about/">About Me</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      
      
      
      
      
    </ul>

   <p>Copyleft &copy; 2016 <a href="https://w3.suse.de/~pgeorgiadis/public/license">License</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>How to submit to QADB when MTUI fails</h1>
    <span class="post-date">Oct 29, 2015 &middot; 4 minute read
    </span>
    <div class="document">


<p>It's quite usual (<em>at least for me</em>) to confront situtations where QADB
submission fails
(<a class="reference external" href="https://bugzilla.suse.com/show_bug.cgi?id=95071">bug#950714</a>).
On top of that, if you try to resubmit, you will come up against another
issue (<a class="reference external" href="https://bugzilla.suse.com/show_bug.cgi?id=950725">bug#950725</a>).
Here's an example describing all the above:</p>
<div class="section" id="run-the-testsuite">
<h1>Run the testsuite</h1>
<p><em>Let's say</em> that you want to run the glibc-testsuite at
<code class="bash">kunkka.qam.suse.de</code></p>
<pre class="code bash literal-block">
mtui&gt; testsuite_run kunkka.qam.suse.de,test_glibc-run
</pre>
</div>
<div class="section" id="where-are-the-testsuite-s-results">
<h1>Where are the testsuite's results ?</h1>
<p>While the testsuite is running, a new folder gets created at the refhost
under the <code class="bash">/var/log/qa</code> directory. The name of this folder is
usually the <code class="bash">RRID</code> of the update
(<em>e.g.</em> <code class="bash">/var/log/qa/SUSE:Maintenance:1179:73089</code>). Inside,
there should be a sub-folder called <code class="bash">ctcs2</code> that contains the results
of all the testsuites related to this particular release candidate.</p>
<pre class="code bash literal-block">
~&gt; ls /var/log/qa/SUSE:Maintenance:1179:73089/
ctcs2
</pre>
<p>In our case, we will find only logs of the glibc-testsuite, because it's
the only testsuite we have run so far.</p>
<pre class="code bash literal-block">
~&gt; ls /var/log/qa/SUSE:Maintenance:1179:73089/ctcs2
qa_test_glibc-2015-10-29-17-18-07
</pre>
<p>and inside this folder, there are the actual results:</p>
<pre class="code bash literal-block">
~&gt; <span class="name builtin">cd</span> /var/log/qa/SUSE:Maintenance:1179:73089/ctcs2/qa_test_glibc-2015-10-29-17-18-07
<span class="comment"># ls
</span>atest-exp         tst-array5-static  tst-cancelx6         tst-endian        tst-getcwd               tst-mbsrtowcs        tst-once2
atest-exp2        tst-atfork1        tst-cancelx7         tst-environ       tst-getdate              tst-mbswcs1          tst-once3
atest-sincos      tst-atime          tst-cancelx8         tst-eof           tst-gethnm               tst-mbswcs2          tst-once4
basic-test        tst-atof1          tst-cancelx9         tst-error1        tst-getlogin             tst-mbswcs3          tst-oncex3
bug16             tst-atof2          tst-chmod            tst-ether_aton    tst-getmyaddr            tst-mbswcs4          tst-oncex4
bug17             tst-atomic         tst-cleanup0         tst-ether_line    tst-getni1               tst-mbswcs5          tst-openat
bug18             tst-atomic-long    tst-cleanup1         tst-exec          tst-getni2               tst-mbswcs6          tst-pcre
bug19             tst-aton           tst-cleanup2         tst-exec1         tst-getpid3              tst-mcheck           tst-perror
<span class="operator">[</span>...<span class="operator">]</span> and others ...
</pre>
<div class="section" id="how-to-see-the-output-of-a-test">
<h2>How to see the output of a test</h2>
<p><em>Let's say</em> that you are interested to check the
results of <code class="bash">tst-cputimer2</code>. All you have to do is <code class="bash">cat</code>
that file:</p>
<pre class="code bash literal-block">
kunkka:/var/log/qa/SUSE:Maintenance:1179:73089/ctcs2/qa_test_glibc-2015-10-29-17-18-07 <span class="comment"># cat tst-cputimer2</span>
</pre>
<p>Output:</p>
<pre class="code bash literal-block">
--
clock_gettime returned <span class="name variable">timespec</span> <span class="operator">=</span> <span class="operator">{</span> 0, 0 <span class="operator">}</span>
clock_getres returned <span class="name variable">timespec</span> <span class="operator">=</span> <span class="operator">{</span> 0, 1 <span class="operator">}</span>
Thu Oct 29 17:21:34 CET 2015: tst-cputimer2 success: on 1/1 after 4s
0 fail 1 succeed 1 count 0 internal_error 0 skipped
</pre>
</div>
</div>
<div class="section" id="submit-your-results">
<h1>Submit your results</h1>
<p>Fear not and submit to QADB using MTUI:</p>
<pre class="code bash literal-block">
mtui&gt; testsuite_submit kunkka.qam.suse.de,test_glibc-run
</pre>
<p>After this command, your submission will either succeed or fail, but in
both cases you should know that the results (located at the refhost) are
moving into another directory. In case of a successful submsion, you are
just fine, since MTUI gives you happily the link of your submission
to QADB.</p>
<pre class="code bash literal-block">
warning: comment strings &gt; 100 chars are truncated by remote_qa_db_report.pl
info: submission <span class="keyword">for </span>kunkka.qam.suse.de <span class="operator">(</span>sles11sp3-x86_64<span class="operator">)</span>: http://qadb2.suse.de/qadb/submission.php?submission_id<span class="operator">=</span>66895
<span class="comment">#                                                           ------------------------------------------------------------
#                                                              the link with your submission of testresults to QADB
</span>info: <span class="keyword">done</span>
</pre>
<p>Accessing this link, you are able to use the QADB's web-interface for
delving into details about results and so on. This is the recommended
procedure, and it's also the reason why <em>almost</em> everybody missed the
part of moving results secretly into another directory. In other words,
the problem is that after submitting to QADB -- <em>no mater if the
submission passes or fails</em> -- the logs are changing directory
in the background.</p>
<p>Here's a schematic of what's happening:</p>
<ul class="simple">
<li>Before the submission</li>
</ul>
<pre class="code bash literal-block">
/var/log/qa/SUSE:Maintenance:1179:73089/ctcs2/qa_test_glibc-2015-10-29-17-18-07
<span class="comment">#           ---------------------------       ---------------------------------
#                    R R I D                   folder is named based on runtime</span>
</pre>
<ul class="simple">
<li>After the submission</li>
</ul>
<pre class="code bash literal-block">
/var/log/qa/oldlogs/2015-10-29-17-47-16/ctcs2/qa_test_glibc-2015-10-29-17-18-07/
<span class="comment">#           ------- --------------------      ---------------------------------
#        new folder based on submission time     old folder based on run time</span>
</pre>
</div>
<div class="section" id="re-submit-your-results">
<h1>Re-submit your results</h1>
<p>If you try to resubmit, MTUI has no clue about the relocation
of the testresults, thus the re-submission is doomed to fail.</p>
<pre class="code bash literal-block">
mtui&gt; testsuite_submit kunkka.qam.suse.de,test_glibc-run
warning: comment strings &gt; 100 chars are truncated by remote_qa_db_report.pl
critical: no submission found <span class="keyword">for </span>kunkka.qam.suse.de. please use <span class="literal string double">&quot;show_log kunkka.qam.suse.de&quot;</span> to see what went wrong
info: <span class="keyword">done</span>
</pre>
<p>That has been said, I've come up with two solutions:</p>
<div class="section" id="either-move-the-folder-back">
<h2>Either move the folder back...</h2>
<p>The concept is to move the testresults' folder back to original directory.
In that way, MTUI will look for the right place for data, it will find them
and happily send them to QADB.</p>
<pre class="code bash literal-block">
kunkka:/ <span class="comment"># cp -R /var/log/qa/oldlogs/2015-10-29-17-47-16/ctcs2/qa_test_glibc-2015-10-29-17-18-07/ /var/log/qa/SUSE:Maintenance:1179:73089/ctcs2/qa_test_glibc-2015-10-29-17-18-07</span>
</pre>
<p>Then, re-submit using MTUI:</p>
<pre class="code bash literal-block">
mtui&gt; testsuite_submit kunkka.qam.suse.de,test_glibc-run
warning: comment strings &gt; 100 chars are truncated by remote_qa_db_report.pl
info: submission <span class="keyword">for </span>kunkka.qam.suse.de <span class="operator">(</span>sles11sp3-x86_64<span class="operator">)</span>: http://qadb2.suse.de/qadb/submission.php?submission_id<span class="operator">=</span>67863
info: <span class="keyword">done</span>
</pre>
<p>It worked as expected. Here's an alternative way:</p>
</div>
<div class="section" id="or-just-submit-directly">
<h2>...Or just submit directly</h2>
<p>In this workaround, I will not use MTUI, but I will use the command that
it executes in the background when submitting results to QADB. Thanks to
Jan, this command can be found <a class="reference external" href="https://gitlab.suse.de/qa-maintenance/mtui/blob/master/mtui/prompt.py#L1124">here</a>.</p>
<pre class="code bash literal-block">
/usr/share/qa/tools/remote_qa_db_report.pl -b -p SLES-11-SP3 -t patch:SUSE:Maintenance:1179:73089 -T pgeorgiadis -f /var/log/qa/oldlogs/2015-10-29-17-47-16 -c <span class="literal string single">'some comment'</span>
</pre>
<p>Output:</p>
<pre class="code bash literal-block">
2015-10-30 16:52:07 +0100 INFO  qa_db_report  Submitted logs have been copied to the archive.
2015-10-30 16:52:07 +0100 INFO  qa_db_report  Submitted logs have been deleted
2015-10-30 16:52:07 +0100 INFO  qa_db_report  Sending mail notifications to vmarsik&#64;suse.cz and pgeorgiadis&#64;suse.com
2015-10-30 16:52:07 +0100 INFO  qa_db_report  All <span class="keyword">done</span> - results were submitted with following submission ID<span class="operator">(</span>s<span class="operator">)</span>:
2015-10-30 16:52:07 +0100 INFO  qa_db_report  ID 67879: http://qadb2.suse.de/qadb/submission.php?submission_id<span class="operator">=</span>67879
</pre>
<p>It also worked.</p>
<p><strong>Notice</strong> though that the logs have been copied and
deleted once again. To avoid this behavior, you could use the <code class="bash">-L</code>
flag.</p>
<pre class="code bash literal-block">
-L  Omits moving the submitted logs from PATH to PATH/oldlogs/
</pre>
<p>So, the command should be:</p>
<pre class="code bash literal-block">
/usr/share/qa/tools/remote_qa_db_report.pl -L -b -p SLES-11-SP3 -t patch:SUSE:Maintenance:1179:73089 -T pgeorgiadis -f /var/log/qa/oldlogs/2015-10-29-17-47-16 -c <span class="literal string single">'some comment'</span>
</pre>
<p>In that way, the files will not get deleted afterwards, and I can run the
above command as many times as I want, without searching for the new
location of the testresults -- because they are not moved.</p>
</div>
</div>
</div>
  </div>
  
</div>




<script src="https://w3.suse.de/~pgeorgiadis/public/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>