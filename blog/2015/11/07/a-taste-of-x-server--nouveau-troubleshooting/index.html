<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>A Taste of X Server &amp; nouveau troubleshooting &middot; Panos Georgiadis</title>

  
  <link rel="stylesheet" href="http://drpaneas.github.io//css/poole.css">
  
  
  
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  
  

  <meta name="description" content="Adventures with Xorg trying to setup triple-head with nouveau">
  <meta name="keywords" content="X Server,nouveau driver,nvidia,xorg.conf">
  <link rel="author" href="http://plus.google.com/PanosGeorgiadis">
</head>
<body class="theme-base-08">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
        <img src="http://drpaneas.github.io/panos.png" alt="panos" height="200" width="200" >
        <h1>Panos Georgiadis</h1>
      
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://drpaneas.github.io//">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="/about/">About Me</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      
      
      
      
      
    </ul>

   <p>Copyleft &copy; 2015 <a href="http://drpaneas.github.io//license">License</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>A Taste of X Server &amp; nouveau troubleshooting</h1>
    <span class="post-date">Nov 7, 2015 &middot; 21 minute read &middot; <a href="http://drpaneas.github.io/blog/2015/11/07/a-taste-of-x-server--nouveau-troubleshooting/#disqus_thread">Comments</a>
    </span>
    

<p>I am not responsible for your system
 or you mental state after reading this guide.
The purpose of this article is to help me understand how
stupid I am trying to setup my multi-head monitors.</p>

<h2 id="physical-display-confiruation:55674f506831bb5b77b4bb618427c08d">Physical Display confiruation:</h2>

<p>This is what I would like to setup:</p>

<pre><code>  ----------   ----------   ----------
 |          | |          | |          |
 | Monitor0 | | Monitor1 | | Monitor2 |
 |          | |          | |          |
  ----------   ----------   ----------
     | |          | |          | |
     | |          | |          | |
    /   \        /   \        /   \
    =====        =====        =====
     DVI          HDMI          VGA
      |            |             |
       ------      |     --------
             \     |   /
              \    |  /
              ===========
             | NVIDIA    |
             | GeForce   |
              ===========
</code></pre>

<p>Eventually, I didn&rsquo;t managed to set it up&hellip; Here&rsquo;s my
story&hellip;</p>

<h2 id="try-with-dynamic-detection:55674f506831bb5b77b4bb618427c08d">Try with dynamic detection</h2>

<p>First all all, make sure there&rsquo;s no <code>/etc/X11/xorg.conf</code>
and if it exists, please remove it. As a side effect, X will try to
configure your displays automatically.</p>

<p>Once you are logged into the Gnome session (fingers&rsquo; crossed),
you are going to experience this:</p>

<pre><code>  ----------   ----------   ----------
 |          | |          | |          |
 | NoSignal | |  Mirror  | |  Mirror  |
 |          | |          | |          |
  ----------   ----------   ----------
     | |          | |          | |
     | |          | |          | |
    /   \        /   \        /   \
    =====        =====        =====
     DEAD           |           |
                    |           |
                     -----------
                 Mirrored by default
</code></pre>

<p>Well, I suppose this is not the case that we want.
We need to explicitely tell X Server how to organise
our triple-head setup.</p>

<h2 id="find-out-the-output-names:55674f506831bb5b77b4bb618427c08d">Find out the Output names</h2>

<p>While you&rsquo;re logged into Gnome, open a terminal
and see the output names using <code>xrandr -q</code>:</p>

<pre><code>Screen 0: minimum 320 x 200, current 1152 x 864, maximum 8192 x 8192

    DVI-I-1 connected (normal left inverted right x axis y axis)
       1680x1050     59.88 +
       1280x1024     75.02    60.02  
       1152x864      75.00  
       1024x768      75.08    60.00  
       800x600       75.00    60.32  
       640x480       75.00    60.00  
       720x400       70.08  

    HDMI-1 connected 1152x864+0+0 (normal left inverted right x axis y axis) 473mm x 296mm
       1680x1050     59.95 +
       1280x1024     75.02    60.02  
       1152x864      75.00* 
       1024x768      75.08    60.00  
       800x600       75.00    60.32  
       640x480       75.00    60.00  
       720x400       70.08  

    VGA-1 connected 1152x864+0+0 (normal left inverted right x axis y axis) 527mm x 297mm
       1920x1080     60.00 +
       1600x900      59.98  
       1280x1024     75.02    60.02  
       1152x864      75.00* 
       1024x768      75.08    60.00  
       800x600       75.00    60.32  
       640x480       75.00    60.00  
       720x400       70.08
</code></pre>

<p>So, the corresponding names for our displays are:</p>

<pre><code>Monitor0 --&gt; DVI-I-1
Monitor1 --&gt; HDMI-1
Monitor2 --&gt; VGA-1
</code></pre>

<h2 id="create-a-very-basic-xorg-conf:55674f506831bb5b77b4bb618427c08d">Create a very basic &ldquo;xorg.conf&rdquo;</h2>

<p>Let&rsquo;s ask X Server to create a very basic &ldquo;xorg.conf&rdquo;
for us. To do that, shutdown any GUI by simply going into
Runlevel 3.</p>

<p><code>~~&gt; telinit 3</code></p>

<p>Then, press <code>CTRL+ALT+F1</code> to go to the first tty and login back
to the system as root. Now, ask the X Server to serve you
the <strong>xorg.conf</strong> configuration file:</p>

<p><code>~~&gt; X -configure</code></p>

<p>This will generate the &ldquo;/root/xorg.conf.new&rdquo; with some standard
configuration. Here it is:</p>

<pre><code>Section &quot;ServerLayout&quot;
    Identifier     &quot;X.org Configured&quot;
    Screen      0  &quot;Screen0&quot; 0 0
    InputDevice    &quot;Mouse0&quot; &quot;CorePointer&quot;
    InputDevice    &quot;Keyboard0&quot; &quot;CoreKeyboard&quot;
EndSection

Section &quot;Files&quot;
    ModulePath   &quot;/usr/lib64/xorg/modules&quot;
    FontPath     &quot;/usr/share/fonts/misc:unscaled&quot;
    FontPath     &quot;/usr/share/fonts/Type1/&quot;
    FontPath     &quot;/usr/share/fonts/100dpi:unscaled&quot;
    FontPath     &quot;/usr/share/fonts/75dpi:unscaled&quot;
    FontPath     &quot;/usr/share/fonts/ghostscript/&quot;
    FontPath     &quot;/usr/share/fonts/cyrillic:unscaled&quot;
    FontPath     &quot;/usr/share/fonts/misc/sgi:unscaled&quot;
    FontPath     &quot;/usr/share/fonts/truetype/&quot;
    FontPath     &quot;built-ins&quot;
EndSection

Section &quot;Module&quot;
    Load  &quot;vnc&quot;
    Load  &quot;glx&quot;
EndSection

Section &quot;InputDevice&quot;
    Identifier  &quot;Keyboard0&quot;
    Driver      &quot;kbd&quot;
EndSection

Section &quot;InputDevice&quot;
    Identifier  &quot;Mouse0&quot;
    Driver      &quot;mouse&quot;
    Option      &quot;Protocol&quot; &quot;auto&quot;
    Option      &quot;Device&quot; &quot;/dev/input/mice&quot;
    Option      &quot;ZAxisMapping&quot; &quot;4 5 6 7&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor0&quot;
    VendorName   &quot;Monitor Vendor&quot;
    ModelName    &quot;Monitor Model&quot;
EndSection

Section &quot;Device&quot;
    ### Available Driver options are:-
    ### Values: &lt;i&gt;: integer, &lt;f&gt;: float, &lt;bool&gt;: &quot;True&quot;/&quot;False&quot;,
    ### &lt;string&gt;: &quot;String&quot;, &lt;freq&gt;: &quot;&lt;f&gt; Hz/kHz/MHz&quot;,
    ### &lt;percent&gt;: &quot;&lt;f&gt;%&quot;
    ### [arg]: arg optional
    #Option     &quot;SWcursor&quot;              # [&lt;bool&gt;]
    #Option     &quot;HWcursor&quot;              # [&lt;bool&gt;]
    #Option     &quot;NoAccel&quot;               # [&lt;bool&gt;]
    #Option     &quot;ShadowFB&quot;              # [&lt;bool&gt;]
    #Option     &quot;VideoKey&quot;              # &lt;i&gt;
    #Option     &quot;WrappedFB&quot;             # [&lt;bool&gt;]
    #Option     &quot;GLXVBlank&quot;             # [&lt;bool&gt;]
    #Option     &quot;ZaphodHeads&quot;           # &lt;str&gt;
    #Option     &quot;PageFlip&quot;              # [&lt;bool&gt;]
    #Option     &quot;SwapLimit&quot;             # &lt;i&gt;
    #Option     &quot;AsyncUTSDFS&quot;           # [&lt;bool&gt;]
    #Option     &quot;AccelMethod&quot;           # &lt;str&gt;
    Identifier  &quot;Card0&quot;
    Driver      &quot;nouveau&quot;
    BusID       &quot;PCI:1:0:0&quot;
EndSection

Section &quot;Screen&quot;
    Identifier &quot;Screen0&quot;
    Device     &quot;Card0&quot;
    Monitor    &quot;Monitor0&quot;
    SubSection &quot;Display&quot;
        Viewport   0 0
        Depth     1
    EndSubSection
    SubSection &quot;Display&quot;
        Viewport   0 0
        Depth     4
    EndSubSection
    SubSection &quot;Display&quot;
        Viewport   0 0
        Depth     8
    EndSubSection
    SubSection &quot;Display&quot;
        Viewport   0 0
        Depth     15
    EndSubSection
    SubSection &quot;Display&quot;
        Viewport   0 0
        Depth     16
    EndSubSection
    SubSection &quot;Display&quot;
        Viewport   0 0
        Depth     24
    EndSubSection
EndSection
</code></pre>

<p>As you can see, it&rsquo;s quite generic. For this reason,
we are going to strip it down to a shorter version:</p>

<pre><code>Section &quot;ServerLayout&quot;
    Identifier     &quot;TripleHead Setup with nouveau&quot;
    Screen      0  &quot;Screen0&quot; 0 0
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor0&quot;
EndSection

Section &quot;Device&quot;
    Identifier  &quot;Card0&quot;
    Driver      &quot;nouveau&quot;
    BusID       &quot;PCI:1:0:0&quot;
EndSection

Section &quot;Screen&quot;
    Identifier &quot;Screen0&quot;
    Device     &quot;Card0&quot;
    Monitor    &quot;Monitor0&quot;
EndSection
</code></pre>

<h2 id="what-does-it-mean:55674f506831bb5b77b4bb618427c08d">What does it mean?</h2>

<p>First of all we need a Monitor, which is equivalent to
our physical display. Normally, we would have 3 Monitor
sections, but hey: this is a very generic and basic, let&rsquo;s
stick to that for now on.</p>

<pre><code>  ----------
 |          | The &quot;Identifier&quot; is just a name. You can put
 | Monitor0 | whatever you want. In this guide, I am sticking
 |          | with the &quot;Monitor&lt;N&gt;&quot; naming-convention.
  ----------
     | |
    /   \
    =====
</code></pre>

<p>Next we need to plug this monitor into our videocard and
make use of the videodriver:</p>

<pre><code>   =================
  |                 |   The &quot;Identifier&quot; could be anything.
  | Card0           |   But, the important part here is the driver which is responsible
  |                 |   for the communication between the Card and the Linux kernel.
   =================
    ||||||||| |||           
    --------- ----         ###########
   | PCIe 01:00.0 | &lt;---&gt;  # nouveau # &lt;---&gt; KERNEL 
    --------- ----         ###########
</code></pre>

<p>Notice that the X found the open soure nvidia driver
used for 3D accelleration, called &ldquo;nouveau&rdquo;. JYFI, you
should not use the old 2D <code>nv</code> driver, because is obsolete
and not maintained.</p>

<p>Just to be on the safe side, make sure that &ldquo;nouveau&rdquo; is loaded:</p>

<p><code>~~&gt; lsmod | grep drm</code></p>

<pre><code>    drm_kms_helper         65670  1 nouveau
    drm                   335594  6 ttm,drm_kms_helper,nouveau
</code></pre>

<p>and also, check that nouveau is the driver that userpace and kernel are using
for your videocard:</p>

<p><code>~~&gt; lspci -nnk | grep -A3 VGA</code></p>

<pre><code>    01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF108 [GeForce GT 440] [10de:0de0] (rev a1)
        Subsystem: ASUSTeK Computer Inc. Device [1043:83b7]
        Kernel driver in use: nouveau
        Kernel modules: nouveau
</code></pre>

<p>Notice that while the PCI BusID is: <strong>&ldquo;01:00.0&rdquo;</strong>
we change it a bit when we are putting this info
into <code>xorg.conf</code> like this: &ldquo;PCI:1:0:0&rdquo;. This information is
optional if you have only one GPU installed (also, no internal graphics).
Otherwise, you have to specify it. For my system, I have Intel graphics
disabled from BIOS and I could have omitted that line from &ldquo;xorg.conf&rdquo;
but because there&rsquo;s always the danger to enable them sometime in the future,
I wouldn&rsquo;t like to end up with broken X. Because in that case, there will be
two PCI Buses:</p>

<p>PCI:1:0:0 &ndash;&gt; nVIDIA
  PCI:0:2:0 &ndash;&gt; Intel Graphics</p>

<p>and if there&rsquo;s no reference into &ldquo;xorg.conf&rdquo; what is what, then it is going to
be a problem.</p>

<p>JFYI, the &ldquo;0x10de&rdquo; is the code for NVIDIA as a vendor
and the &ldquo;0x0d30&rdquo; is the code for the specific device (GeForce GT 440).
In case you need to validate these information, you can search
for the kernel&rsquo;s data which are related to PCI bus:</p>

<pre><code>:~ # cat /sys/bus/pci/devices/0000\:01\:00.0/vendor 
0x10de

:~ # cat /sys/bus/pci/devices/0000\:01\:00.0/device 
0x0de0
</code></pre>

<p>The only problem with the device section is that I cannot
tell which monitor I want to use. That&rsquo;s why there is another section
called &ldquo;Screen&rdquo; which is going to be the &ldquo;link&rdquo; between &ldquo;Monitor&rdquo; and &ldquo;Device&rdquo;
sections.</p>

<hr />

<p>|                                          |
 |    &mdash;&mdash;&mdash;&ndash;      =================                    |
 |   |       |    |         |                   | The screen is just a visual
interface
 |   | Monitor 0 |    | Card0       |                   | used to combine a
monitor with a
 |   |       |    |             |                   | device.
 |    &mdash;&mdash;&mdash;&ndash;      =================                    |
 |       | |        ||||||||| |||                           |
 |      /   \      &mdash;&mdash;&mdash; &mdash;-         ###########           |
 |      =====      | PCIe 01:00.0 | &lt;&mdash;&gt;  # nouveau # &lt;&mdash;&gt; KERNEL     |
 |                 &mdash;&mdash;&mdash; &mdash;-         ###########           |
 |                                      |
 |          Screen0                         |</p>

<hr />

<p>Notice, that we haven&rsquo;t yet mentioned how the card0 is connected with the
Monitor0.
That has been said, X Server doesn&rsquo;t know if the monitor we are talking about
is VGA-0, DVI-I-1 or HDMI-1. We let X Server (for now) to choose this
automatically.</p>

<p>Last but not least, we need a Layout Section. This section is used in order to
place our screens in position. For now own, we have only one Monitor, thus
we need to define this screen as the primary one.</p>

<pre><code>    Screen      0  &quot;Screen0&quot; 0 0

                        ^            ^ ^
                        |            | |
 Primary ---------------             | | relative positions (x horizontal,
</code></pre>

<p>y vertical)
                              x &mdash;&mdash;&mdash;  | which means the upper left corner
of our display
                              y &mdash;&mdash;&mdash;&ndash;</p>

<ol>
<li>Start the X Server:
&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-</li>
</ol>

<p>In order to start X Server and tell it to use this file you have 2 ways:</p>

<pre><code>I. Either, place the file into the appropriate directory:

    :~&gt; cp xorg.conf.new /etc/X11/xorg.conf

   and then start X server:

    :~&gt; X


II. Or, you simply can pass the configuration file as an parameter
    while starting the X Server (recommended):


    :~&gt; X -config /root/xorg.conf.new
</code></pre>

<p>You are going to see a black screen (this is surprisingly good)
which means that X Server is running. Go again back to &lsquo;tty1&rsquo;
and kill it by pressing &ldquo;ctrl+c&rdquo;.</p>

<p>Now, view the logs:</p>

<pre><code>:~&gt; vim /var/log/Xorg.0.log
</code></pre>

<p>First, let&rsquo;s see if X Server uses the same Output-names
as XRandR does:</p>

<pre><code>:~&gt; grep &quot;Output.*connected&quot; /var/log/Xorg.0.log

    [  3409.088] (II) NOUVEAU(0): Output DVI-I-1 connected
    [  3409.088] (II) NOUVEAU(0): Output HDMI-1 connected
    [  3409.088] (II) NOUVEAU(0): Output VGA-1 connected
</code></pre>

<p>The answer here is: yes it does.
Do you remember that we didn&rsquo;t tell X Server what Output name is used
for our monitor? Let&rsquo;s see what X Server probing picked up automatically:</p>

<pre><code>[  7177.781] (II) NOUVEAU(0): Output DVI-I-1 using monitor section Monitor0
[  7177.813] (II) NOUVEAU(0): Output HDMI-1 has no monitor section
[  7177.845] (II) NOUVEAU(0): Output VGA-1 has no monitor section
</code></pre>

<p>So, X Server thinks that my Monitor0 is connected using DVI. Which is correct,
but
this is pure luck. Let&rsquo;s see the resolution that X chose:</p>

<pre><code>[  7177.945] (II) NOUVEAU(0): Output DVI-I-1 using initial mode 1152x864
[  7177.945] (II) NOUVEAU(0): Output HDMI-1 using initial mode 1152x864
[  7177.945] (II) NOUVEAU(0): Output VGA-1 using initial mode 1152x864
</code></pre>

<p>Hm, it makes sense (if you look my output from xrandr) that 1152x864 is the
higher resolution
supported by <em>all</em> of my displays.</p>

<p>Let&rsquo;s try to fire-up gnome and see what is going to be. To do that, we first
have to place the
configuration to the right place:</p>

<pre><code>:~&gt; cp xorg.conf.new /etc/X11/xorg.conf
</code></pre>

<p>and go into graphical target (aka Runlevel 5):</p>

<pre><code>:~&gt; telinit 5
</code></pre>

<p>However, I still get the same result as my first state (without &ldquo;xorg.conf&rdquo;).
Let&rsquo;s make sure first that X Server is reading our configuration:</p>

<pre><code>[  7848.626] (==) Using config file: &quot;/etc/X11/xorg.conf&quot;
</code></pre>

<p>So, the file is the correct one.</p>

<pre><code>[  7848.627] (==) ServerLayout &quot;TripleHead Setup with nouveau&quot;
[  7848.627] (**) |--&gt;Screen &quot;Screen0&quot; (0)
[  7848.627] (**) |   |--&gt;Monitor &quot;Monitor0&quot;
[  7848.627] (**) |   |--&gt;Device &quot;Card0&quot;
</code></pre>

<p>So does the rest of the setup. Let&rsquo;s try to force Monitor0 to be the DVI-I-1
connection
and see what happens. Go into your &ldquo;device section&rdquo; and put this line:</p>

<pre><code>Option      &quot;Monitor-DVI-I-1&quot;   &quot;Monitor0&quot;
</code></pre>

<p>and see what happens. In order to test this, we are going to follow the same
procedure:</p>

<pre><code>1. Change /etc/X11/xorg.conf
    2. Go to 'runlevel 3'
    3. Start X Server by typing &quot;X&quot;
    4. Go to tty1 (press ctrl+alt+F1)
    5. Kill the X Server (pres ctrl+c)
    6. See the logs (vi /var/log/Xorg.0.log)
7. Go to 'runlevel 5'
</code></pre>

<p>Hm, it didn&rsquo;t change. Same results.</p>

<h2 id="5-optimize-xorg-conf:55674f506831bb5b77b4bb618427c08d">5) Optimize xorg.conf</h2>

<p>Let&rsquo;s try to add 3 monitors, which are going to be like our 3 displays.</p>

<pre><code>Section &quot;Monitor&quot;
    Identifier   &quot;Monitor0&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor1&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor2&quot;
EndSection
</code></pre>

<p>And let&rsquo;s connect the to corresponding hardware according to my setup:</p>

<pre><code>Section &quot;Device&quot;
    Identifier  &quot;Card0&quot;
    Driver      &quot;nouveau&quot;
    BusID       &quot;PCI:1:0:0&quot;
    Option      &quot;Monitor-DVI-I-1&quot;   &quot;Monitor0&quot;
    Option      &quot;Monitor-HDMI-1&quot;    &quot;Monitor1&quot;
    Option      &quot;Monitor-VGA-1&quot;     &quot;Monitor2&quot;
EndSection
</code></pre>

<p>let&rsquo;s test. Same result (from Gnome) but the logs have changed:</p>

<pre><code>[  8893.423] (II) NOUVEAU(0): Output DVI-I-1 using monitor section Monitor0
[  8893.455] (II) NOUVEAU(0): Output HDMI-1 using monitor section Monitor1
[  8893.487] (II) NOUVEAU(0): Output VGA-1 using monitor section Monitor2
</code></pre>

<p>Which is the correct configuration:</p>

<pre><code>      ----------   ----------   ----------  
     |      | |      | |          |
     | Monitor0 | | Monitor1 | | Monitor2 |
     |      | |      | |          |
      ----------   ----------   ----------
         | |      | |          | |
         | |      | |          | |
        /   \    /   \        /   \
        =====    =====        =====

        DVI          HDMI          VGA

          |           |     |
           ------     |    ---------
             \    |   /
              \   |  /
             ===========
            | NVIDIA    |
            | GeForce   |
             ===========
</code></pre>

<p>Checking if they are all connected:</p>

<pre><code>[  8893.587] (II) NOUVEAU(0): Output DVI-I-1 connected
[  8893.587] (II) NOUVEAU(0): Output HDMI-1 connected
[  8893.587] (II) NOUVEAU(0): Output VGA-1 connected
</code></pre>

<p>They are all connected but still, I get:</p>

<pre><code>      ----------   ----------   ----------  
     |      | |      | |          |
     | NoSignal | |  Mirror  | |  Mirror  |
     |      | |      | |          |
      ----------   ----------   ----------
         | |      | |          | |
         | |      | |          | |
        /   \    /   \        /   \
        =====    =====        =====

        DEAD           |        |
               |        |
                ------------ 
              Mirrored by default
</code></pre>

<p>Check the logs:</p>

<pre><code>[  8893.587] (II) NOUVEAU(0): Output DVI-I-1 using initial mode 1152x864
[  8893.587] (II) NOUVEAU(0): Output HDMI-1 using initial mode 1152x864
[  8893.587] (II) NOUVEAU(0): Output VGA-1 using initial mode 1152x864
</code></pre>

<p>Well, let&rsquo;s try to disable the Mirrored-ones (Monitor1 and Monitor2)
by putting this line into their &ldquo;Monitor Sections&rdquo;</p>

<pre><code>Option       &quot;Ignore&quot;   &quot;True&quot;
</code></pre>

<p>So, it will look like this:</p>

<pre><code>Section &quot;Monitor&quot;
    Identifier   &quot;Monitor0&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor1&quot;
    Option       &quot;Ignore&quot;   &quot;True&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor2&quot;
    Option       &quot;Ignore&quot;   &quot;True&quot;
EndSection
</code></pre>

<p>and continue testing&hellip;.</p>

<p>Voila! For the first time, now, X Server does what we told him to do.</p>

<pre><code>      ----------   ----------   ----------  
     |      | |      | |          |
     | Working  | | Disabled | | Disabled |
     |      | |      | |          |
      ----------   ----------   ----------
         | |      | |          | |
         | |      | |          | |
        /   \    /   \        /   \
        =====    =====        =====

       Monitor0     Monitor1     Monitor2
        DVI          HDMI          VGA
</code></pre>

<p>let&rsquo;s see what the logs has to say about this new change:</p>

<pre><code>[  9346.246] (II) NOUVEAU(0): Output DVI-I-1 using monitor section Monitor0
[  9346.278] (II) NOUVEAU(0): Output HDMI-1 using monitor section Monitor1
[  9346.278] (**) NOUVEAU(0): Option &quot;Ignore&quot; &quot;True&quot;
[  9346.310] (II) NOUVEAU(0): Output VGA-1 using monitor section Monitor2
[  9346.310] (**) NOUVEAU(0): Option &quot;Ignore&quot; &quot;True&quot;
</code></pre>

<p>which is correct (known from the previous configuration), but notice
that HDMI-1 and VGA-1 are now marked with the &ldquo;Ignore&rdquo; option.</p>

<pre><code>[  9346.346] (II) NOUVEAU(0): Output DVI-I-1 connected
</code></pre>

<p>Which has as a result that only DVI-I-1 to be connected.</p>

<pre><code>[  9346.346] (II) NOUVEAU(0): Output DVI-I-1 using initial mode 1680x1050    
</code></pre>

<p>and as long as this is the only display, X server picked up the best resolution
supported
by my monitor (which makes sense because there is no other other monitor to
operate with).</p>

<p>So, let&rsquo;s try to leave only the HDMI disabled and see what is going to be. To
do that
remove the &ldquo;Ignore&rdquo; line from Monitor1.</p>

<pre><code>Section &quot;Monitor&quot;
    Identifier   &quot;Monitor0&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor1&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor2&quot;
    Option       &quot;Ignore&quot;   &quot;True&quot;
EndSection
</code></pre>

<p>and Test</p>

<p>Works! Here&rsquo;s the expected results:</p>

<pre><code>      ----------   ----------   ----------  
     |      | |      | |          |
     | Primary  | | 2ndary   | | Disabled |
     |      | |      | |          |
      ----------   ----------   ----------
         | |      | |          | |
         | |      | |          | |
        /   \    /   \        /   \
        =====    =====        =====

       Monitor0     Monitor1     Monitor2
        DVI          HDMI          VGA
</code></pre>

<p>let&rsquo;s see the logs:</p>

<pre><code>[ 10227.375] (II) NOUVEAU(0): Output DVI-I-1 using monitor section Monitor0
[ 10227.407] (II) NOUVEAU(0): Output HDMI-1 using monitor section Monitor1
[ 10227.439] (II) NOUVEAU(0): Output VGA-1 using monitor section Monitor2
[ 10227.439] (**) NOUVEAU(0): Option &quot;Ignore&quot; &quot;True&quot;
</code></pre>

<p>That&rsquo;s correct. Only the Monitor2 (VGA) is disabled.</p>

<p><a href="II"> 10227.507</a> NOUVEAU(0): Output DVI-I-1 connected
<a href="II"> 10227.507</a> NOUVEAU(0): Output HDMI-1 connected</p>

<p>Again, that&rsquo;s correct. The VGA-1 is disconnected ;)</p>

<p><a href="II"> 10227.507</a> NOUVEAU(0): Using exact sizes for initial modes
<a href="II"> 10227.507</a> NOUVEAU(0): Output DVI-I-1 using initial mode 1680x1050
<a href="II"> 10227.507</a> NOUVEAU(0): Output HDMI-1 using initial mode 1680x1050</p>

<p>and also, my two monitors seems to have same resolution.</p>

<p>So, dual-head works. What&rsquo;s happens and thins go crazy when I am using 3
connected monitors.
So, far to my understaning is that the only thing that changes is the
placement. When
we have two monitors, it&rsquo;s pretty normal that one is going to be &ldquo;left&rdquo; and the
other
is going to be &ldquo;right&rdquo;. For my current configuration, the primary monitor is
the left one,
which is monitor0. This can be also verified from gnome:</p>

<pre><code>Monitor0 ---&gt; Primary
Monitor1 ---&gt; Secondary
</code></pre>

<p>so, if I need to place a third monitor, maybe we need to statically say to X
Server
where my third monitor is going to be:</p>

<pre><code>Section &quot;Monitor&quot;
    Identifier   &quot;Monitor0&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor1&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor2&quot;
    Option       &quot;RightOf&quot;  &quot;Monitor1&quot;
</code></pre>

<p>let&rsquo;s test it</p>

<p>Well, not exactly what I was expected:</p>

<pre><code>      ----------   ----------   ----------  
     |      | |      | |          |
     | NoSignal | | Primary  | | 2ndary   |
     |      | |      | |          |
      ----------   ----------   ----------
         | |      | |          | |
         | |      | |          | |
        /   \    /   \        /   \
        =====    =====        =====

       Monitor0     Monitor1     Monitor2
        DVI          HDMI          VGA
</code></pre>

<p>let&rsquo;s see what the logs have to say about this new thing:</p>

<pre><code>[ 10778.986] (II) NOUVEAU(0): Output DVI-I-1 using monitor section Monitor0
[ 10779.018] (II) NOUVEAU(0): Output HDMI-1 using monitor section Monitor1
[ 10779.050] (II) NOUVEAU(0): Output VGA-1 using monitor section Monitor2
[ 10779.050] (**) NOUVEAU(0): Option &quot;RightOf&quot; &quot;Monitor1&quot;
</code></pre>

<p>which is correct.</p>

<pre><code>[ 10779.151] (II) NOUVEAU(0): Output DVI-I-1 connected
[ 10779.151] (II) NOUVEAU(0): Output HDMI-1 connected
[ 10779.151] (II) NOUVEAU(0): Output VGA-1 connected
</code></pre>

<p>which is correct</p>

<pre><code>[ 10779.151] (II) NOUVEAU(0): Using user preference for initial modes
[ 10779.151] (II) NOUVEAU(0): Output DVI-I-1 using initial mode 1680x1050
[ 10779.151] (II) NOUVEAU(0): Output HDMI-1 using initial mode 1680x1050
[ 10779.151] (II) NOUVEAU(0): Output VGA-1 using initial mode 1600x900
</code></pre>

<p>My third monitor uses different resolution (doesn&rsquo;t supprot 1680x1050).
So, as a last chance let&rsquo;s try to say the place for its display except from
the primary one (monitor0).</p>

<pre><code>Section &quot;Monitor&quot;
    Identifier   &quot;Monitor0&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor1&quot;
    Option       &quot;RightOf&quot;  &quot;Monitor0&quot;
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor2&quot;
    Option       &quot;RightOf&quot;  &quot;Monitor1&quot;
EndSection
</code></pre>

<p>AAnd test&hellip;</p>

<p>same result&hellip;.</p>

<p>After a <em>lot</em> of hacking into the &ldquo;xorg.conf&rdquo; file I didn&rsquo;t manage to enable
all three monitors.
The problem seems to be the CRTC. Most hardware only have 2 CRTCs, which means
that they have only
2 rendering pipelines. Simply put, only two 2 displays output ports can be
enabled at the same time.
I can see the CRTC using xrandr:</p>

<pre><code>:~&gt; xrandr --verbose | grep CRTC

    CRTCs:      0 1
    CRTC:       0
    CRTCs:      0 1
    CRTC:       1
    CRTCs:      0 1
</code></pre>

<p>Which means:</p>

<pre><code>Monitor0 (DVI)  --&gt; Supports: 0 and 1 --&gt; Enabled: none , so that's why it
</code></pre>

<p>is turned off
    Monitor1 (HDMI) &ndash;&gt; Supports: 0 and 1 &ndash;&gt; Enabled: 0 (Working)
    Monitor1 (VGA)  &ndash;&gt; Supports: 0 and 1 &ndash;&gt; Enabled: 1 (Working)</p>

<p>This is why X Server disabled one display out of three, because there&rsquo;s no
enough CRTCs to use.
Thus, we are doomed to use only 2 monitors.</p>

<ol>
<li>DualHead Setup:
~~~~~~~~~~~~~~~~~~</li>
</ol>

<p>Since I am going to use only two monitors, I will pick the monitors that they
have
the same resolution. But before configure and visual screen (shared window),
let&rsquo;s enable them:</p>

<pre><code>      ----------   ----------   ----------  
     |      | |      | |          |
     | Primary  | | Secondary| |   Off    |
     |      | |      | |          |
      ----------   ----------   ----------
         | |      | |          | |
         | |      | |          | |
        /   \    /   \        /   \
        =====    =====        =====

       Monitor0     Monitor1     Monitor2
        DVI          HDMI          VGA
</code></pre>

<p>This is the setup we I am going to start with:</p>

<pre><code>Section &quot;ServerLayout&quot;
    Identifier     &quot;DualHead Setup with nouveau&quot;    # Let's change the name
</code></pre>

<p>from triple to dual
        Screen      0  &ldquo;Screen0&rdquo; 0 0
    EndSection</p>

<pre><code>Section &quot;Monitor&quot;
    Identifier   &quot;Monitor0&quot;
    Option       &quot;Primary&quot;  &quot;True&quot;          # Force Monitor0 to be the
</code></pre>

<p>Primary one
    EndSection</p>

<pre><code>Section &quot;Monitor&quot;
    Identifier   &quot;Monitor1&quot;
    Option       &quot;RightOf&quot;  &quot;Monitor0&quot;      # This is going to be the
</code></pre>

<p>secondary display
    EndSection</p>

<pre><code>Section &quot;Monitor&quot;
    Identifier   &quot;Monitor2&quot;
    Option       &quot;RightOf&quot;  &quot;Monitor1&quot;
    Option       &quot;Ignore&quot;   &quot;True&quot;          # Turn this off (no CRTC left)
EndSection

Section &quot;Device&quot;
    Identifier  &quot;Card0&quot;
    Driver      &quot;nouveau&quot;
    BusID       &quot;PCI:1:0:0&quot;
    Option      &quot;Monitor-DVI-I-1&quot;   &quot;Monitor0&quot;
    Option      &quot;Monitor-HDMI-1&quot;    &quot;Monitor1&quot;
    Option      &quot;Monitor-VGA-1&quot;     &quot;Monitor2&quot;
EndSection


Section &quot;Screen&quot;
    Identifier &quot;Screen0&quot;
    Device     &quot;Card0&quot;
    Monitor    &quot;Monitor0&quot;
EndSection
</code></pre>

<p>and let&rsquo;s test.</p>

<p>And it works. The result is as expected:</p>

<pre><code>      ----------   ----------   ----------  
     |      | |      | |          |
     | Primary  | | Secondary| |   Off    |
     |      | |      | |          |
      ----------   ----------   ----------
         | |      | |          | |
         | |      | |          | |
        /   \    /   \        /   \
        =====    =====        =====

       Monitor0     Monitor1     Monitor2
        DVI          HDMI          VGA
</code></pre>

<p>let&rsquo;s see the logs:</p>

<pre><code>[ 66561.307] (II) NOUVEAU(0): Output DVI-I-1 using monitor section Monitor0
[ 66561.307] (**) NOUVEAU(0): Option &quot;Primary&quot; &quot;True&quot;
[ 66561.339] (II) NOUVEAU(0): Output HDMI-1 using monitor section Monitor1
[ 66561.339] (**) NOUVEAU(0): Option &quot;RightOf&quot; &quot;Monitor0&quot;
[ 66561.371] (II) NOUVEAU(0): Output VGA-1 using monitor section Monitor2
[ 66561.371] (**) NOUVEAU(0): Option &quot;RightOf&quot; &quot;Monitor1&quot;
[ 66561.371] (**) NOUVEAU(0): Option &quot;Ignore&quot; &quot;True&quot;
...
...
...
[ 66561.440] (II) NOUVEAU(0): Output DVI-I-1 connected
[ 66561.440] (II) NOUVEAU(0): Output HDMI-1 connected
</code></pre>

<p>which is correct. We had to disable the 3rd screen (Monitor1) because our
hardware
supports only 2 CRTCS:</p>

<pre><code>[ 66561.371] (II) NOUVEAU(0): 2 crtcs needed for screen.
[ 66561.375] (II) NOUVEAU(0): Allocated crtc nr. 0 to this screen.
[ 66561.375] (II) NOUVEAU(0): Allocated crtc nr. 1 to this screen.
</code></pre>

<p>Indeed, X Server confirms that 2 CRTCs are needed for the screen:</p>

<pre><code>        ------------------------
CRTC 0 ---&gt;    |            | 
CRTC 1 ---&gt;    |  Monitor0     Monitor1 |
           |            |
        ------------------------
                  | |
              | |
             /   \
             =====
</code></pre>

<p>Let&rsquo;s see what resolution is picked from X automatically:</p>

<p><a href="II"> 66561.440</a> NOUVEAU(0): Using user preference for initial modes
<a href="II"> 66561.440</a> NOUVEAU(0): Output DVI-I-1 using initial mode 1680x1050
<a href="II"> 66561.440</a> NOUVEAU(0): Output HDMI-1 using initial mode 1680x1050</p>

<p>As expected, 1680x1050 is the top resolution for each of my individual
displays,
thus X server picked this up for both of them.</p>

<p>The &ldquo;trick&rdquo; I love in this configuration is that we are using only one screen,
called &ldquo;Screen0&rdquo;. This config, forced X Server to automatically combine
my two monitors, into the same screen, and not separate. Simply put,
there&rsquo;s only one DISPLAY env variable for both of my displays, which means
that I can share windows (moving them from one display to another).
The technical term for this Screen is called &ldquo;Visual Screen&rdquo;, which
unifies the monitors into a greater resolution:</p>

<pre><code>            1680 + 1680 = 3360
    -----------------------------
       |  -----------   -----------  |
       | |       | |       | |
       | | 1680x1050 | | 1680x1050 | |
       | |       | |       | |
       |  -----------   -----------  |
       |     | |       | |       |
       |     | |       | |       |
       |    /   \     /   \      |
       |    =====     =====      |
        -----------------------------
           |   |
           |   |
          /     \
         /   \
         =========

               Visual Screen 3360x1050
</code></pre>

<p>So, let&rsquo;s see if my calculations are related to logs:</p>

<pre><code>[ 66561.440] (--) NOUVEAU(0): Virtual size is 3360x1050 (pitch 0)
</code></pre>

<p>indeed they are :)
So, the the X Server picked the correct mode (resolution + refresh rate) and
combined them altogether:</p>

<pre><code>[ 66561.440] (**) NOUVEAU(0):  Driver mode &quot;1680x1050&quot;: 146.2 MHz (scaled
</code></pre>

<p>from 0.0 MHz), 65.3 kHz, 60.0 Hz
    <a href="II"> 66561.440</a> NOUVEAU(0): Modeline &ldquo;1680x1050&rdquo;x60.0  146.25  1680 1784
1960 2240  1050 1053 1059 1089 -hsync +vsync (65.3 kHz eP)</p>

<p>If the X Server has problem detecting the best mode, you have to explicitely,
set it up into the &ldquo;xorg.conf&rdquo;
But first you need to know the complete list of modes that your display
supports:</p>

<pre><code>:~ # xrandr 

    DVI-I-1 connected primary 1680x1050+0+0 (normal left inverted right x
</code></pre>

<p>axis y axis) 473mm x 296mm
           1680x1050     59.88*+
           1280x1024     75.02    60.02<br />
           1152x864      75.00<br />
           1024x768      75.08    60.00<br />
           800x600       75.00    60.32<br />
           640x480       75.00    60.00<br />
           720x400       70.08</p>

<pre><code>    HDMI-1 connected 1680x1050+1680+0 (normal left inverted right x axis y
</code></pre>

<p>axis) 473mm x 296mm
           1680x1050     59.95*+
           1280x1024     75.02    60.02<br />
           1152x864      75.00<br />
           1024x768      75.08    60.00<br />
           800x600       75.00    60.32<br />
           640x480       75.00    60.00<br />
           720x400       70.08</p>

<p>So, for my displays, the best mode for them to work together is 1680x1050@59.95
In order to generate the &ldquo;modeline&rdquo; I am going to use the &ldquo;gtf&rdquo; tool:</p>

<pre><code>gtf 1680 1050 59.95

  # 1680x1050 @ 59.95 Hz (GTF) hsync: 65.17 kHz; pclk: 147.01 MHz
  Modeline &quot;1680x1050_59.95&quot;  147.01  1680 1784 1968 2256  1050 1051 1054
</code></pre>

<p>1087  -HSync +Vsync</p>

<p>and then you have to put this info in your &ldquo;xorg.conf&rdquo;. For my case this
optional, because
X Server already pick this modeline by itself, but it not quite optimized:</p>

<pre><code>X Server    ---&gt; Modeline &quot;1680x1050&quot;x60.0  146.25  1680 1784 1960 2240
</code></pre>

<p>1050 1053 1059 1089 -hsync +vsync (65.3 kHz eP)
    gtf version &mdash;&gt; Modeline &ldquo;1680x1050_59.95&rdquo;  147.01  1680 1784 1968 2256
1050 1051 1054 1087  -HSync +Vsync</p>

<p>So, let&rsquo;s put the &ldquo;gtf&rdquo; result into my Xorg and see what happens:</p>

<pre><code>Section &quot;ServerLayout&quot;
    Identifier     &quot;DualHead Setup with nouveau&quot;
    Screen      0  &quot;Screen0&quot; 0 0
EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor0&quot;
    Option       &quot;Primary&quot;  &quot;True&quot;
    Modeline     &quot;1680x1050_59.95&quot;  147.01  1680 1784 1968 2256  1050 1051
</code></pre>

<p>1054 1087  -HSync +Vsync # The gtf version
        Option       &ldquo;PreferredMode&rdquo;    &ldquo;1680x1050_59.95&rdquo;</p>

<h1 id="tell-x-to-pick-the-gtf-version:55674f506831bb5b77b4bb618427c08d">Tell X to pick the gtf version</h1>

<pre><code>EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor1&quot;
    Option       &quot;RightOf&quot;  &quot;Monitor0&quot;
    Modeline     &quot;1680x1050_59.95&quot;  147.01  1680 1784 1968 2256  1050 1051
</code></pre>

<p>1054 1087  -HSync +Vsync # same
        Option       &ldquo;PreferredMode&rdquo;    &ldquo;1680x1050_59.95&rdquo;</p>

<h1 id="same:55674f506831bb5b77b4bb618427c08d">same</h1>

<pre><code>EndSection

Section &quot;Monitor&quot;
    Identifier   &quot;Monitor2&quot;
    Option       &quot;RightOf&quot;  &quot;Monitor1&quot;
    Option       &quot;Ignore&quot;   &quot;True&quot;
EndSection

Section &quot;Device&quot;
    Identifier  &quot;Card0&quot;
    Driver      &quot;nouveau&quot;
    BusID       &quot;PCI:1:0:0&quot;
    Option      &quot;Monitor-DVI-I-1&quot;   &quot;Monitor0&quot;
    Option      &quot;Monitor-HDMI-1&quot;    &quot;Monitor1&quot;
    Option      &quot;Monitor-VGA-1&quot;     &quot;Monitor2&quot;
EndSection


Section &quot;Screen&quot;
    Identifier &quot;Screen0&quot;
    Device     &quot;Card0&quot;
    Monitor    &quot;Monitor0&quot;

    SubSection &quot;Display&quot;        # Define the Virtual screen
              Depth     24          # 24 is kind of a default nowadays
      Virtual   3360 1050       # The visual screen resolution
    EndSubSection

EndSection
</code></pre>

<p>And test it&hellip;</p>

<p>All good! Let&rsquo;s see the logs:</p>

<pre><code>[ 74689.115] (II) NOUVEAU(0): Using user preference for initial modes
[ 74689.115] (II) NOUVEAU(0): Output DVI-I-1 using initial mode
</code></pre>

<p>1680x1050_59.95
    <a href="II"> 74689.115</a> NOUVEAU(0): Output HDMI-1 using initial mode
1680x1050_59.95</p>

<p>Ah so, the X server picked our preference and used our modeline. Great :D</p>

<pre><code>[ 74689.115] (--) NOUVEAU(0): Virtual size is 3360x1050 (pitch 0)
[ 74689.115] (**) NOUVEAU(0):  Mode &quot;1680x1050_59.95&quot;: 147.0 MHz (scaled
</code></pre>

<p>from 0.0 MHz), 65.2 kHz, 59.9 Hz
    <a href="II"> 74689.115</a> NOUVEAU(0): Modeline &ldquo;1680x1050_59.95&rdquo;x59.9  147.01  1680
1784 1968 2256  1050 1051 1054 1087 -hsync +vsync (65.2 kHz UP)</p>

<p>Here you can compare 1:1 the Modeline that X Server is using now, which is
identicall to the &ldquo;gtf&rdquo;.</p>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "panosblog";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "panosblog";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://drpaneas.github.io//js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  var _gaq=[['_setAccount','UA-60257842-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
</html>